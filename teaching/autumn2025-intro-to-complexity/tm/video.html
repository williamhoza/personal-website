<!DOCTYPE html>
<head>
    <meta charset="UTF-8"> 

    <style>
        .absent {
            stroke-width:3;
            stroke: #7F7F7F;
            stroke-dasharray:5;
        }

        .cell {
            fill:none;
        }
        .cell.present {
            stroke-width:3;
            stroke:black;
            fill:#FBE5D6;
        }

        #head {
            stroke-width:3;
            stroke:black;
            fill:#00ffff;
            transition:all 300ms;
        }

        .cell-symbol {
            text-anchor:middle;
            dominant-baseline:middle;
            font-size:24px;
            fill:#7f7f7f;
        }
        .cell-symbol.present {
            fill:#000;
        }

        #state {
            text-anchor:middle;
            dominant-baseline:middle;
            font-size:18px;
            transition:all 300ms;
        }

        #head, #state {
            transform:translateX(0px);
        }

        body {
            background-color:#fff;
        }

        #tmContainer {
            border:6px ridge #ddd;
            backgroxund-color:#ffe;
        }
    </style>
</head>
<html>
    <body>
        <svg id="tmContainer" width="500" height="120" viewBox = "-100 0 500 120">
            <polygon id="head" points="50,65 70,100 30,100" />
            <text id="state" x="50" y="90">S</text>
        </svg>
        <script>
            const tmContainer = document.querySelector("#tmContainer");
            const head = document.querySelector("#head");
            const stateTxt = document.querySelector("#state");
            let state = 0; // 0 means start; 1 means scan right; 2 means increment
            let tapeContents = {0: "⊔", 1: "1", 2: "0", 3: "1"};
            let headLocation = 0;
            let cellElements = {};
            let tapeTextElements = {};


            function getSymbol(loc) {
                return loc in tapeContents ? tapeContents[loc] : "⊔";
            }
            
            function setSymbol(s) {
                tapeContents[headLocation] = s;
                tapeTextElements[headLocation].textContent = s;
            }

            function update() {
                let currentSymbol = getSymbol(headLocation);

                // Transition function is hard-coded here for now
                if (state == 0) {
                    // Move right
                    state = 1;
                    headLocation = headLocation + 1;
                } else if (state == 1) {
                    // Scan right
                    if (currentSymbol == "⊔") {
                        state = 2;
                        headLocation = headLocation - 1;
                    } else {
                        headLocation = headLocation + 1;
                    }
                } else if (state == 2) {
                    // Increment
                    if (currentSymbol == "0" || currentSymbol == "⊔") {
                        setSymbol("1");
                        state = 1;
                        headLocation = headLocation + 1;
                    } else if (currentSymbol == "1") {
                        setSymbol("0");
                        headLocation = headLocation - 1;
                    }
                }

                
                tapeTextElements[headLocation].classList.add("present");
                cellElements[headLocation].classList.add("present");

                if (state == 0) stateTxt.textContent = "S";
                if (state == 1) stateTxt.textContent = "R";
                if (state == 2) stateTxt.textContent = "I";
                head.style.transform = `translateX(${headLocation * 50}px)`;
                stateTxt.style.transform = `translateX(${headLocation * 50}px)`;
            }

            function init() {

                let done = false;
                let i = 0;
                while (!done) {
                    let txt = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    txt.setAttribute("x", 50 * (i + 1) + "");
                    txt.setAttribute("y", "52");
                    txt.classList.add("cell-symbol");
                    if (i in tapeContents) {
                        txt.classList.add("present");
                    }
                    txt.textContent = getSymbol(i);
                    tmContainer.prepend(txt);
                    tapeTextElements[i] = txt;

                    let sq = document.createElementNS("http://www.w3.org/2000/svg","rect");
                    sq.setAttribute("width", "50");
                    sq.setAttribute("height", "50");
                    sq.classList.add("cell")
                    if (i in tapeContents) {
                        sq.classList.add("present");
                    }
                    sq.setAttribute("x", 50 * i + 25 + "");
                    sq.setAttribute("y", "25");
                    tmContainer.prepend(sq);
                    cellElements[i] = sq;

                    let vert = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    vert.setAttribute("x1", 50 * i + 25 + "");
                    vert.setAttribute("y1", "25");
                    vert.setAttribute("x2", 50 * i + 25 + "");
                    vert.setAttribute("y2", "75");
                    vert.classList.add("absent");
                    tmContainer.prepend(vert);

                    if (0 <= i && i < 100) {
                        i = -i - 1;
                    } else if (i < 0) {
                        i = -i;
                    } else if (i == 100) {
                        done = true;
                    }
                }

                topLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
                topLine.setAttribute("x1", "-500");
                topLine.setAttribute("y1", "25");
                topLine.setAttribute("x2", "500");
                topLine.setAttribute("y2", "25");
                topLine.classList.add("absent");
                tmContainer.prepend(topLine);

                bottomLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
                bottomLine.setAttribute("x1", "-500");
                bottomLine.setAttribute("y1", "75");
                bottomLine.setAttribute("x2", "500");
                bottomLine.setAttribute("y2", "75");
                bottomLine.classList.add("absent");
                tmContainer.prepend(bottomLine);
            }

            init();
            setInterval(update, 500);

        </script>
    </body>
</html>